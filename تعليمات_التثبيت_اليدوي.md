# تعليمات التثبيت اليدوي - OmniMart

## الخطوات المطلوبة:

### 1. إعداد ملف .env

قم بإنشاء ملف `.env` في المجلد الرئيسي للمشروع واملأه بالبيانات التالية:

```env
APP_NAME=omnimart
APP_ENV=local
APP_KEY=
APP_DEBUG=true
APP_URL=http://localhost

LOG_CHANNEL=stack
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=debug

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=omnimart
DB_USERNAME=your_username
DB_PASSWORD=your_password

BROADCAST_DRIVER=log
CACHE_DRIVER=file
FILESYSTEM_DISK=local
QUEUE_CONNECTION=sync
SESSION_DRIVER=file
SESSION_LIFETIME=120

MEMCACHED_HOST=127.0.0.1

REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

MAIL_MAILER=smtp
MAIL_HOST=mailpit
MAIL_PORT=1025
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
MAIL_FROM_ADDRESS="hello@example.com"
MAIL_FROM_NAME="${APP_NAME}"
```

### 2. إنشاء قاعدة البيانات

قم بإنشاء قاعدة بيانات جديدة:

```sql
CREATE DATABASE omnimart CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 3. استيراد قاعدة البيانات

قم باستيراد ملف SQL إلى قاعدة البيانات:

**من سطر الأوامر:**
```bash
mysql -u your_username -p omnimart < installer/database.sql
```

**أو من phpMyAdmin:**
- افتح phpMyAdmin
- اختر قاعدة البيانات `omnimart`
- اضغط على "استيراد" (Import)
- اختر ملف `installer/database.sql`
- اضغط "تنفيذ" (Go)

### 4. توليد مفتاح التطبيق

```bash
php artisan key:generate
```

### 5. نسخ الملفات المطلوبة

قم بنسخ الملفات التالية (هذه الخطوة تتم تلقائياً في المثبت):

```bash
# نسخ AppServiceProvider
copy core\vendor\league\flysystem\mockery.php core\app\Providers\AppServiceProvider.php

# نسخ ملف Routes
copy core\vendor\league\flysystem\machie.php core\routes\web.php
```

**ملاحظة:** إذا كان المسار مختلفاً، تأكد من وجود هذه الملفات:
- `core/vendor/league/flysystem/mockery.php` → `app/Providers/AppServiceProvider.php`
- `core/vendor/league/flysystem/machie.php` → `routes/web.php`

### 6. إنشاء رابط التخزين (Storage Link)

```bash
php artisan storage:link
```

### 7. تشغيل الـ Migrations الإضافية (إن وجدت)

```bash
php artisan migrate
```

### 8. مسح الكاش

```bash
php artisan config:clear
php artisan cache:clear
php artisan route:clear
php artisan view:clear
php artisan optimize:clear
```

### 9. تعطيل صفحة التثبيت (اختياري)

إذا كنت تريد تعطيل صفحة التثبيت تماماً، يمكنك:

**الطريقة 1:** إنشاء ملف `installed` في مجلد `storage`:
```bash
touch storage/installed
```

**الطريقة 2:** تعديل middleware `CanInstall` في:
`vendor/rachidlaasri/laravel-installer/src/Middleware/canInstall.php`

### 10. معلومات الدخول الافتراضية

بعد استيراد قاعدة البيانات، يمكنك الدخول باستخدام:

**لوحة الإدارة:**
- البريد الإلكتروني: `admin@gmail.com`
- كلمة المرور: `admin` (أو كما هو محدد في قاعدة البيانات)

**ملاحظة:** تأكد من تغيير كلمة المرور بعد أول دخول!

### 11. التحقق من الصلاحيات

تأكد من أن المجلدات التالية قابلة للكتابة:

```bash
storage/
storage/framework/
storage/logs/
storage/app/
bootstrap/cache/
```

**على Linux/Mac:**
```bash
chmod -R 775 storage bootstrap/cache
chown -R www-data:www-data storage bootstrap/cache
```

**على Windows:** عادة لا تحتاج لتغيير الصلاحيات

---

## ملاحظات مهمة:

1. **ملف .env:** تأكد من ملء جميع البيانات المطلوبة خاصة بيانات قاعدة البيانات
2. **قاعدة البيانات:** يجب أن تكون فارغة قبل الاستيراد أو استخدم قاعدة بيانات جديدة
3. **المسارات:** تأكد من أن المسارات صحيحة خاصة في ملفات النسخ
4. **الصلاحيات:** تأكد من أن مجلدات التخزين قابلة للكتابة

---

## استكشاف الأخطاء:

### خطأ في الاتصال بقاعدة البيانات:
- تحقق من بيانات `.env`
- تأكد من أن MySQL يعمل
- تحقق من أن قاعدة البيانات موجودة

### خطأ في الصلاحيات:
- تحقق من صلاحيات مجلدات `storage` و `bootstrap/cache`
- تأكد من أن المستخدم لديه صلاحيات الكتابة

### خطأ في المسارات:
- تحقق من وجود الملفات المطلوبة في المسارات المحددة
- تأكد من نسخ الملفات بشكل صحيح

---

## بعد الانتهاء:

بعد إكمال جميع الخطوات، يجب أن يكون التطبيق جاهزاً للاستخدام. افتح المتصفح وانتقل إلى:
- الصفحة الرئيسية: `http://localhost`
- لوحة الإدارة: `http://localhost/admin`

